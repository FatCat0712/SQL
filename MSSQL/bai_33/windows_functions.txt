Windows Functions

_ hoặc là (Windowed Functions) là một tính năng mạnh mẽ trong SQL Server cho phép chúng ta thực hiện tính toán trên một tập dữ liệu con (window) của bảng dữ liệu, thay vì trên toàn bộ bảng 

* Các loại Windows Functions

+ Aggregate Functions : Được sử dụng để thực hiện tính toán tổng hợp như SUM, AVG, COUNT trên một window

+ Ranking Functions: Được sử dụng để xếp hạng các dòng dữ liệu trong một window, ví dụ: ROW_NUMBER, RANK, DENSE_RANK

+ Analytic Functions: Cho phép thực hiện tính toán trên các dòng dữ liệu trong window và trả về kết quả cho mỗi dòng mà không làm thay đổi kích thước của kết quả,
ví dụ: LAG, LEAD, FIRST_VALUE, LAST_VALUE.

* Cú pháp cơ bản

FUNCTION_NAME(expression) OVER(
	[PARTITION BY partition_expression, ... ]
	[ORDER BY sort_expression [ASC | DESC], ... ]
	[ROWS BETWEEN frame_specification]
)

* Danh sách các Functions

+ ROW_NUMBER(): gán một số thứ tự (row number) duy nhất cho mỗi dòng trong window, bắt đầu từ 1.

+ RANK() : xếp hạng các dòng dựa trên giá trị của cột được sắp xếp. Giá trị trùng lặp được xếp hạng giống nhau và bỏ qua các số xếp hạng sau.

+ DENSE_RANK(): tương tự như RANK(), nhưng giá trị trùng lặp có cùng một số xếp hạng và không bị bỏ qua các số xếp hạn sau.

+ NTILE(n) : chia dữ liệu thành n phần bằng nhau và gán một số xác định cho mỗi dòng để xác định thành phần nào của dữ liệu dòng đó thuộc về.

+ LAG(column, n): trả về giá trị của cột cho dòng trước đó (hoặc dòng thứ n trước đó) trong window.

+ LEAD(column, n): trả về giá trị của cột cho dòng sau đó (hoặc dòng thứ n sau đó) trong window.

+ FIRST_VALUE(column): trả về giá trị đầu tiên của cột trong window.

+ LAST_VALUE(column): trả về giá trị cuối cùng của cột trong window.

+ SUM(column): tính tổng giá trị của cột trong window.

+ AVG(column): tính giá trị trung bình của cột trong window.

+ COUNT(column) : đếm số lượng dòng có giá trị không null của cột trong window

+ MIN(column) : Tìm giá trị nhỏ nhất của cột trong window

+ MAX(column) : Tìm giá trị lớn nhất của cột trong window

+ PERCENT_RANK(): xếp hạng dòng dựa trên phần trăm vị trí của dòng trong window. trả về giá trị từ 0 đến 1

+ CUME_DIST() : xác định xem dòng đó thuộc phần bao nhiêu phần trăm của dữ liệu trong window. Trả về giá trị từ 0 đến 1